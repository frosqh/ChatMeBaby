<!DOCTYPE html>
<html>
<head>
 <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="front/css/chat.css">
  <link rel="stylesheet" type="text/css" href="front/css/chat.css">
  <link rel="stylesheet" type="text/css" href="front/css/radiobutton.css">
  <link rel="stylesheet" type="text/css" href="front/css/button.css">
  <link rel="stylesheet" type="text/css" href="front/css/combobox.css">
  <link rel="stylesheet" type="text/css" href="front/css/index.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
  <link rel="icon" href="Logo/LogoTrans.png" type="image/png" sizes="16x16">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>
<body id="body">

  <div class="header" style="background: linear-gradient(0.25turn,#0951c4, #95b4e5,#0951c4);">
    <a href="home.html"><img id='LogoTransparent' src="Logo/LogoWithNameTrans.png" alt="LogoTransparent" /></a>
    <div class="connectedUser">
      <% if (user!='Anonymous') {%>
      <table id="userText" border="0">
        <td><%= user %></td>
        <td id="settingico"><a href="/profile"><img src="Logo/Icones/settings.png"/></a></td>
        <td class="settingsPage" id="signoutico"><a href='/logout'><img src="Logo/Icones/signOut.png"/></a></td>
      </table>
      <%} else {%>
      <a href='/login' style='text-decoration: none'> Log in !</a>
      <% } %>
    </div>
  </div>

  <div class="topnav">
    <a href="/">Home</a>
    <a class="indexPage" href="channel.html">MyChatRooms</a>
    <a href="#">MyChatFriends</a>
    <a href="#">Surprise Me!</a>
    <div class="searchbarbutton">
      <form id="searchForm" method="post">
        <input class="searchbar" type="text" placeholder="Search ..." style="border:none; outline:none; border-bottom:1px solid #757575;"/>
        <input class="searchbutton" type="submit" value=""></input>
      </form>
    </div>
  </div>

<div class="row">
  <div class="client_channel_list_container">
    <div class="sidebar">
      <a href="/"><img src="Logo/LogoWithNameTrans.png" style="height:70px; width:auto; padding-left: 25px; padding-top:5px;"/></a>
      <div class="workingLab_sidebar">
        <div class="menu_user">
          <div class="disponible"></div>
          <p class="username"> <=% user %> </p>
        </div>
      </div>
      <div class="channel_sidebar">
        <p class="channelTitle">Channels<button id="newchan" class="newchan"></button></p>

	<%for (i in channels) { %>
	<p class="channel <% if (i==0){%> active_channel <%}%>"> <%= channels[i] %></p>
	<% } %>
      </div>
      <div class="privateMessage_sidebar">
        <p class="PrivateMessageTitle">Private Message</p>
      </div>
      <div class="addPeople_sidebar">
        <p class="addPeople">Add people</p>
      </div>
      <div class="baby_sidebar">
        <p class="babyTitle">Chat new babies</p>
        <p class="baby">New Baby</p>
        <p class="baby">Random baby</p>
      </div>
    </div>
  </div>


  <div class="rightcolumn">
    <div class="topnavchat">
      <div class="channelNam">
        <p><b>#channelName</b></p>
      </div>
    </div>
    <div class = content>
      <section id="zone_chat">

      </section>
    </div>
    <form class="form" method="post" id="formulaire_chat">
      <div>
        <input type="text" name="message" id="message" placeholder="Votre message..." size="50" autofocus autocomplete="off" class="input_text"/>
        <input type="submit" id="envoi_message">
        </input>
      </div>
    </form>

  </div>

</div>

<!-- The Modal Add -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <form id="myFormMembers" method="post">
    <table border="0" width="100%">
      <tr>
        <td style="background: #6632ba; padding: 10px 20px 0 0; text-align: center;">
          <span id="span" class="close">&times;</span>
          <p id="myModalTitle">Create a new channel</p>
        </td>
      </tr>
      <tr>
        <td>
          <table id="tableForm" border="0" width="100%">
            <!-- Channel name and status -->
            <tr>
              <td width=55% style="color: #081419; font-family: 'Roboto-Regular', 'Roboto'; font-size: 18px; line-height: 20px; padding: 10px 0 5px 25px;">
                <label for="nom">Create a channel</label><br>
              </td>

              <td width=45% style="color: #081419; font-family: 'Roboto-Regular', 'Roboto'; font-size: 18px; line-height: 20px; padding: 10px 0 5px 25px;">
                <label for="nom">Status</label><br>
              </td>
            </tr>
            <tr>
              <td style="padding: 0 30px 5px 20px;">
                <input type="text" class="inNewChan" name="channelname" id="channelname" title="You must enter the channel name." placeholder="Channel name.." autofocus required/>
              </td>

              <td style="padding: 8px 0 5px 15px;">
                <input type="radio" name="status" id="public" checked/>
                <label class="label" for="public">Public</label>
                <input type="radio" name="status" id="private" />
                <label class="label" for="private">Private</label>
              </td>
            </tr>
            <!-- Add members -->
            <tr>
              <td width=45% style="color: #081419; font-family: 'Roboto-Regular', 'Roboto'; font-size: 18px; line-height: 20px; padding: 10px 0 5px 25px;">
                <label for="nom">Add members</label><br>
              </td>

              <td width=45% style="color: #ffffff; font-family: 'Roboto-Regular', 'Roboto'; font-size: 18px; line-height: 20px; padding: 10px 0 5px 25px;">
                <label for="nom">Add members</label><br>
              </td>
            </tr>

            <tr>
              <td id="memberInputs" style="padding: 0 10px 0 30px;">
                <div>
                  <input id="inp1" type="text" class="inNewChan" name="member1" id="member1" title="New member." placeholder="New member.."/>
                </div>
              </td>

              <td id="buttonInputs" style="padding: 8px 0 5px 15px;">
                <div>
                  <button type="button" class="add" onclick="addInput(this)" id="1"></button>
                </div>
              </td>
            </tr>
          </table>
        </td>
      </tr>

      <!-- Create the new channel -->
      <tr>
        <td align="center" style="padding-top: 10px; padding-bottom: 30px;">
          <a href=# class=button onclick="sendForm()">
            <span style="font-size: 36px;">Create !</span>
          </a>
        </td>
      </tr>

    </table>
  </form>
  </div>
</div>

<!-- The Modal Members -->
<div id="myModalMembers" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <form id="myFormMembers" method="post">
    <table border="0" width="100%">
      <tr>
        <td style="background: #6632ba; padding: 10px 20px 0 0; text-align: center;">
          <span id="spanMembers" class="close">&times;</span>
          <p id="myModalTitle">Add Members</p>
        </td>
      </tr>
      <tr>
        <td>
          <table id="tableForm" border="0" width="100%">
            <!-- Channel name and status -->
            <tr>
              <td width=55% style="color: #081419; font-family: 'Roboto-Regular', 'Roboto'; font-size: 18px; line-height: 20px; padding: 10px 0 5px 25px;">
                <label for="nom">Select channel</label><br>
              </td>

              <td width=45% style="color: #081419; font-family: 'Roboto-Regular', 'Roboto'; font-size: 18px; line-height: 20px; padding: 10px 0 5px 25px;">
                <label for="nom">Status</label><br>
              </td>
            </tr>
            <tr>
              <td style="padding: 0 30px 5px 20px;">
                <div class="styled-select purple semi-square">
                  <select id="channelnameMembers">
                    <option value="volvo">Volvo</option>
                    <option value="saab">Saab</option>
                    <option value="opel">Opel</option>
                    <option value="audi">Audi</option>
                  </select>
                </div>
              </td>

              <td style="padding: 8px 0 5px 15px;">
                <input type="radio" name="status" id="public" disabled/>
                <label class="label" for="public">Public</label>
                <input type="radio" name="status" id="private" disabled/>
                <label class="label" for="private">Private</label>
              </td>
            </tr>
            <!-- Add members -->
            <tr>
              <td width=45% style="color: #081419; font-family: 'Roboto-Regular', 'Roboto'; font-size: 18px; line-height: 20px; padding: 10px 0 5px 25px;">
                <label for="nom">Add members</label><br>
              </td>

              <td width=45% style="color: #ffffff; font-family: 'Roboto-Regular', 'Roboto'; font-size: 18px; line-height: 20px; padding: 10px 0 5px 25px;">
                <label for="nom">Add members</label><br>
              </td>
            </tr>

            <tr>
              <td id="MmemberInputs" style="padding: 0 10px 0 30px;">
                <div>
                  <input id="M1inp" type="text" class="inNewChan" name="member1" title="New member." placeholder="New member.."/>
                </div>
              </td>

              <td id="MbuttonInputs" style="padding: 8px 0 5px 15px;">
                <div>
                  <button id="M1" type="button" class="add" onclick="MaddInput(this)"></button>
                </div>
              </td>
            </tr>
          </table>
        </td>
      </tr>

      <!-- Create the new channel -->
      <tr>
        <td align="center" style="padding-top: 10px; padding-bottom: 30px;">
          <a href=# class=button onclick="sendFormMembers()">
            <span style="font-size: 36px;">Add them !</span>
          </a>
        </td>
      </tr>

    </table>
  </form>
  </div>
</div>

<script src="JS/modalNewChan.js" language="Javascript" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="JS/channel.js"></script>
<script>

    var user = '<%= user %>'
    // Connexion � socket.io
    var socket = io.connect();
    var lastMsg=false;
    $('.channelNam p b').html($('.active_channel').text());

    refresh($('.active_channel').text());
    // On demande le pseudo, on l'envoie au serveur et on l'affiche dans le titre

    socket.emit('login', {
      username: user
    });
    $('.menu_user .username').text(user);

    // Quand un nouveau client se connecte, on affiche l'information
    socket.on('nouveau_client', function(user) {
        $('.privateMessage_sidebar').append('<div class="user" id="'+user.id+'"><div class="disponible"></div><p class="username">'+user.username+'</p></div>');
    })

    // Quand un nouveau client se deconnecte, on affiche l'information
    socket.on('deconnexion_client',function(user){
      $('#'+user.id).children("div").toggleClass("disponible");
      $('#'+user.id).children("div").toggleClass("absent");
    })

    // Lorsqu'on envoie le formulaire, on transmet le message et on l'affiche sur la page
    $('#formulaire_chat').submit(function (e) {
        e.preventDefault();
        date= new Date();
        if($('#message').val()!=''){
          socket.emit('message', {
            content :$('#message').val(),
            user    :user,
            hour    :date.getHours(),
            minute  :date.getMinutes(),
            channel :$('.active_channel').text()
          }); // Transmet le message aux autres
          $('#message').val('').focus(); // Vide la zone de Chat et remet le focus dessus

        }
    });

    // Quand on recoit un message, on l'insere dans la page
    socket.on('msg', function(message) {
      if(message.channel==$('.active_channel').text()){
        if(lastMsg != message.user){
          $('#zone_chat').append('<div class="sender-name"><img class="avatar" src="https://scontent-cdt1-1.xx.fbcdn.net/v/t1.0-9/29792871_130672044443074_3886540281580134733_n.png?_nc_cat=0&oh=ba0d45495f5506030849de77f27b16b6&oe=5B73A591" width="32" height="32"/><div class="sender">'+message.user+'</div><div class="time">'+message.hour+':'+message.minute+'</div><div class="message_content"><div class="message_body">  <strong>|</strong> ' + message.content + '</div></div></div>');
          lastMsg = message.user;
        } else {
          $('#zone_chat').append('<div class="message_content"><div class="time">'+message.hour+':'+message.minute+'</div><div class="message_body">  <strong>|</strong> ' + message.content + '</div></div>');
          $('.content').animate({scrollTop : $('.content').prop('scrollHeight')},500);
        }
      }
    })

        socket.on('test', function(data) {
          console.log('Incoming message:'+ data);
        });

</script>

<script>
// Get the modal
var modal = document.getElementById('myModal');
var modalMembers = document.getElementById('myModalMembers');

// Get the button that opens the modal
var btn = document.getElementById("newchan");
var btnMembers = document.getElementById("addPeople");

// Get the <span> element that closes the modal
var span = document.getElementById("close");
var spanMembers = document.getElementById("closeMembers");

// When the user clicks on the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}
btnMembers.onclick = function() {
  modalMembers.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}
spanMembers.onclick = function() {
  modalMembers.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
      modal.style.display = "none";
  }
  if (event.target == modalMembers) {
      modalMembers.style.display = "none";
  }
}
</script>

</body>
</html>
